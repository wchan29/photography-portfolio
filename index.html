<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Anson Chan - Portfolio</title>
  <meta name="description"
    content="Hello there, I'm Sophia Williams – an intrepid explorer through the lens, on a relentless quest to capture the world's boundless wonders. Join me in unraveling the extraordinary through my lens as I embark on a visual journey like no other.">

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="dist/assets/favicon.ico" />
  <link rel="stylesheet" href="dist/output.css" />
  <link rel="stylesheet" href="styles.css" />

  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Signika:wght@400;700&display=swap" rel="stylesheet">

  <!-- Fancybox -->
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css" />

  <!-- jQuery (not required for this gallery, but kept since your site includes it) -->
  <script src="https://code.jquery.com/jquery-3.6.3.min.js"
    integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>

  <!-- Tailwind CDN (you already have dist/output.css too, keeping as-is) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      content: ["./dist/*.{html,js}"],
      theme: {
        extend: {
          fontFamily: {
            'nothingyoucoulddo': ['Nothing You Could Do', 'cursive'],
            'signika': ['Signika', 'sans-serif'],
          },
        },
      },
      plugins: [],
    }
  </script>

  <!-- Ensure animate-fade-in exists (your body uses it; your gallery img uses it too) -->
  <style>
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .animate-fade-in {
      animation: fadeIn 0.6s ease forwards;
    }
  </style>
</head>

<body class="dark:bg-black bg-white h-screen text-black dark:text-white px-5 md:px-20 opacity-0 animate-fade-in transition duration-500">
  <!-- Navbar -->
  <div id="header"></div>
  <script>
    fetch("src/header.html")
      .then(response => response.text())
      .then(data => {
        const header = document.getElementById("header");
        header.innerHTML = data;
        if (window.Alpine) {
          Alpine.initTree(header);
        }
      });
  </script>

  <!-- Content -->
  <div class="container mx-auto">
    <h1 class="text-4xl pt-10 pb-8 font-bold">PORTFOLIO</h1>

    <section class="text-neutral-700">
      <div class="container w-full">
        <div class="flex flex-wrap w-full" id="galleryRoot"></div>
      </div>
    </section>

    <p id="galleryStatus" class="mt-3 text-sm text-neutral-500"></p>
  </div>

  <!-- Footer -->
  <div id="footer"></div>
  <script>
    fetch("src/footer.html")
      .then(response => response.text())
      .then(data => {
        document.getElementById("footer").innerHTML = data;

        // Set current year AFTER footer is injected
        const yearEl = document.getElementById("currentYear");
        if (yearEl) {
          yearEl.textContent = new Date().getFullYear();
        }
      });
  </script>

  <!-- Load and render gallery.json -->
  <script>
    function escapeHtml(s) {
      return String(s ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    async function loadGalleryFromJson() {
      const root = document.getElementById("galleryRoot");
      const status = document.getElementById("galleryStatus");

      // ✅ CHANGE THIS if your JSON is not next to index.html
      // Examples:
      //   "gallery.json"
      //   "assets/gallery.json"
      //   "dist/gallery.json"
      const GALLERY_JSON_PATH = "gallery.json";

      try {
        status.textContent = "Loading gallery…";

        const res = await fetch(GALLERY_JSON_PATH, { cache: "no-store" });
        if (!res.ok) {
          throw new Error(`Could not fetch ${GALLERY_JSON_PATH} (HTTP ${res.status})`);
        }

        const payload = await res.json();

        // Support either:
        //  1) { groups: [...], items: [...] }  (recommended)
        //  2) [ {src, alt, ...}, ... ]         (legacy list: no groups)
        let groups = [];
        let items = [];

        if (Array.isArray(payload)) {
          // Legacy fallback: one group containing all items
          groups = [{
            id: "default",
            name: "Gallery",
            containerClass: "flex w-full flex-wrap"
          }];
          items = payload.map((x) => ({
            src: x.src,
            alt: x.alt || "",
            groupId: "default",
            widthClass: x.widthClass || "w-full",
            paddingClass: x.paddingClass || "p-1",
          }));
        } else {
          groups = Array.isArray(payload.groups) ? payload.groups : [];
          items = Array.isArray(payload.items) ? payload.items : [];
        }

        if (!groups.length) {
          // If groups are missing, still render everything as one group
          groups = [{
            id: "default",
            name: "Gallery",
            containerClass: "flex w-full flex-wrap"
          }];
          items = items.map((it) => ({ ...it, groupId: "default" }));
        }

        // Build grouped layout (your "half width container" pattern)
        const html = groups.map((g) => {
          const containerClass = escapeHtml(
            g.containerClass || "flex w-full md:w-1/2 flex-wrap"
          );

          const children = items
            .filter((it) => it.groupId === g.id)
            .map((it) => {
              const src = escapeHtml(it.src || "");
              const alt = escapeHtml(it.alt || "");
              const widthClass = escapeHtml(it.widthClass || "w-full");
              const paddingClass = escapeHtml(it.paddingClass || "p-1");

              // If a bad path slips in, avoid rendering broken empty anchors
              if (!src) return "";

              return `
                <div class="${widthClass} ${paddingClass}">
                  <div class="overflow-hidden h-full w-full">
                    <a href="${src}" data-fancybox="gallery">
                      <img
                        src="${src}"
                        alt="${alt}"
                        loading="lazy"
                        class="block h-full w-full object-cover object-center opacity-0 animate-fade-in transition duration-500 transform scale-100 hover:scale-110"
                      />
                    </a>
                  </div>
                </div>
              `;
            })
            .join("");

          return `<div class="${containerClass}">${children}</div>`;
        }).join("");

        root.innerHTML = html;

        // Rebind Fancybox AFTER inserting new DOM
        if (window.Fancybox) {
          try { Fancybox.unbind('[data-fancybox="gallery"]'); } catch (e) {}
          Fancybox.bind('[data-fancybox="gallery"]', {});
        }

        status.textContent = "";
      } catch (err) {
        console.error(err);
        status.textContent =
          "Gallery failed to load. Ensure gallery.json is reachable and you are using a local server (not file://).";
      }
    }

    document.addEventListener("DOMContentLoaded", loadGalleryFromJson);
  </script>

  <!-- Your existing scripts -->
  <script src="dist/fade_in.js"></script>
  <script src="dist/menu.js"></script>
</body>
</html>

